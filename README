
This is a simple in page chat that can pop up on a user action, like pressing a "chat now" button or something. The script only reqires jQuery 1.7.x and PHP on the server side together with a writable directory for the chat data files. NO database is needed.

The server side comes with simple CSRF protection to prevent users to initiate chats under random user IDs.

---

CSRF PROTECTION

The chat does not know your users, you need to do the authentification and check if two users are actually allowed to talk to each other. If you find that user "A" may talk to user "B", then just set two $_SESSION variables in PHP, one containing "me" user's IDs and the other containing a random string to protect against CSRF attacks:

    $_SESSION['popupchat_me'] = USER_ID
    $_SESSION['popupchat_csrf'] = CSRF_TOKEN

Additionally, you must include the same CSRF_TOKEN string and both users' IDs into the HTML page when attaching the chat to a DOM object:

    $('#chatbox').popupchat({
        csrf: 'CSRF_TOKEN',
        me: { id:USER_A_ID, nick:'NickUserA', chat:'Me' },
        them: { id:USER_B_ID, nick:'NickUserB', chat:'NickUserB' },
    });

The CSRF string will be sent to the server on each request and compared to the token stored in the $_SESSION variable. Also, the "me" user ID in the $_SESSION will be compared to the user variables sent by the client on each request, to make sure a user can not chat under somebody else's user ID.

---

REMOVE OLD CHAT DATA FILES

From time to time check the access timestamp of all chatdata files and delete all files older than 7 days (or 30 days or so). Do it with a cronjob using find -atime something.

---

